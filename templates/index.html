<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentalytics : AI for Mental Health Monitoring</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        h1 {
            color: #343a40;
        }
        hr {
            border-top: 1px solid #dee2e6;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .form-group label {
            font-weight: bold;
        }
        video {
            border: 2px solid #007bff;
            border-radius: 5px;
            max-width: 100%;
        }
        #sentiment-plot {
            max-width: 100%;
            height: auto;
            border: 2px solid #343a40;
            border-radius: 5px;
            margin-top: 15px;
        }
        #facial-result, #whatsapp-result, #speech-result, #multimodal-result {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5 text-center">Mentalytics : AI for Mental Health Monitoring</h1>
        <hr>
        
        <!-- Facial Emotion Analysis Section -->
        <div class="mt-5">
            <h3>Facial Emotion Analysis</h3>
            <button id="start-camera" class="btn btn-primary">Start Camera</button>
            <video id="video" width="640" height="480" autoplay></video>
            <div id="facial-result" class="mt-3"></div>
        </div>
        
        <hr>
        
        <!-- Sentiment Analysis of WhatsApp Chat Section -->
        <div class="mt-5">
            <h3>Sentiment Analysis of WhatsApp Chat</h3>
            <form id="whatsapp-chat-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="chat-file">Upload WhatsApp Chat Text File:</label>
                    <input type="file" class="form-control-file" id="chat-file" name="file" accept=".txt" required>
                </div>
                <button type="button" class="btn btn-primary" onclick="analyzeWhatsAppChat()">Analyze WhatsApp Chat</button>
            </form>
            <div id="whatsapp-result" class="mt-3">
                <img id="sentiment-plot" class="mt-3" style="display: none;" />
            </div>
        </div>
        
        <hr>
        
        <!-- Speech Emotion Analysis Section -->
        <div class="mt-5">
            <h3>Speech Emotion Analysis</h3>
            <form id="speech-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="speech-file">Upload an Audio File (.wav):</label>
                    <input type="file" class="form-control-file" id="speech-file" name="file" accept="audio/wav" required>
                </div>
                <button type="button" class="btn btn-primary" onclick="analyzeSpeechEmotion()">Analyze Speech Emotion</button>
            </form>
            <div id="speech-result" class="mt-3"></div>
        </div>
        
        <hr>
        
        
    </div>

    <script>
        const video = document.getElementById('video');
        const startCameraButton = document.getElementById('start-camera');

        // Start Camera and Analyze Facial Emotion in Real Time
        startCameraButton.addEventListener('click', () => {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.style.display = 'block';
                    analyzeFacialEmotion();
                })
                .catch(err => {
                    console.error("Error accessing camera: ", err);
                });
        });

        function analyzeFacialEmotion() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 640;
            canvas.height = 480;

            setInterval(() => {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const dataURL = canvas.toDataURL('image/jpeg');

                fetch('/analyze_facial_emotion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ image: dataURL })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('facial-result').innerText = 'Facial Emotion: ' + JSON.stringify(data.emotions);
                })
                .catch(error => {
                    console.error('Error analyzing face: ', error);
                });
            }, 2000); // Analyze every 2 seconds
        }

        // WhatsApp Chat Analysis
        function analyzeWhatsAppChat() {
            const formData = new FormData(document.getElementById('whatsapp-chat-form'));

            fetch('/analyze_whatsapp_chat', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errorMessage => {
                        throw new Error(errorMessage.error || 'Unknown error occurred');
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('whatsapp-result').innerText = 'Error: ' + data.error;
                } else {
                    // Display sentiment counts
                    document.getElementById('whatsapp-result').innerText = `Positive: ${data.positive}, Negative: ${data.negative}`;
                    
                    // Display the sentiment plot image
                    const img = document.getElementById('sentiment-plot');
                    if (img) {
                        img.src = 'data:image/png;base64,' + data.image;
                        img.style.display = 'block';
                    }
                }
            })
            .catch(error => {
                document.getElementById('whatsapp-result').innerText = 'Error: ' + error.message;
            });
        }

        // Analyze Speech Emotion
        function analyzeSpeechEmotion() {
            const formData = new FormData(document.getElementById('speech-form'));

            fetch('/analyze_speech_emotion', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById('speech-result').innerText = 'Error: ' + data.error;
                } else if (data.sentiment) {
                    document.getElementById('speech-result').innerText = 'Speech Emotion: ' + data.sentiment;
                } else {
                    document.getElementById('speech-result').innerText = 'Error: Unexpected response format';
                }
            })
            .catch(error => {
                document.getElementById('speech-result').innerText = 'Error: ' + error.message;
            });
        }

        // Perform Multimodal Analysis
        function analyzeMultimodal() {
            const facialEmotion = document.getElementById('facial-result').innerText;
            const chatSentiment = document.getElementById('whatsapp-result').innerText;
            const speechEmotion = document.getElementById('speech-result').innerText;

            fetch('/multimodal_analysis', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    facial_emotion: facialEmotion,
                    voice_emotion: speechEmotion,
                    sentiment: chatSentiment
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('multimodal-result').innerText = 'Multimodal Analysis: ' + data.analysis;
            })
            .catch(error => {
                document.getElementById('multimodal-result').innerText = 'Error: ' + error;
            });
        }
    </script>
</body>
</html>